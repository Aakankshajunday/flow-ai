<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Flow System - AI-Powered Workflow Automation</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            font-size: 3rem;
            color: #4a5568;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2rem;
            color: #718096;
            margin-bottom: 20px;
        }

        .header-badges {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Main Content Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .card h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2 i {
            color: #667eea;
        }

        /* Input Section */
        .input-section {
            grid-column: 1 / -1;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .input-group input, .input-group textarea, .input-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            background: white;
        }

        .input-group input:focus, .input-group textarea:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(72, 187, 120, 0.3);
        }

        /* Examples Section */
        .examples-section {
            margin-bottom: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 25px;
            color: white;
        }
        
        .examples-section h2 {
            color: white;
            margin-bottom: 15px;
        }
        
        .examples-section p {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 20px;
        }
        
        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .example-card {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .example-card:hover {
            border-color: white;
            background: rgba(255, 255, 255, 1);
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        .example-card h4 {
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .example-card p {
            color: #718096;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        /* Results Section */
        .results-section {
            grid-column: 1 / -1;
        }

        .results-header {
            background: #f7fafc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .results-header h3 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .result-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .result-card:hover {
            border-color: #667eea;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .result-card h4 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.2rem;
            line-height: 1.4;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 8px 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .metric-label {
            font-weight: 600;
            color: #4a5568;
        }

        .metric-value {
            color: #718096;
        }

        /* Features Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-card i {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 20px;
        }

        .feature-card h3 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .feature-card p {
            color: #718096;
            line-height: 1.6;
        }

        /* Status Indicators */
        .status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .status.success {
            background: #f0fff4;
            color: #38a169;
            border: 1px solid #9ae6b4;
        }

        .status.error {
            background: #fed7d7;
            color: #e53e3e;
            border: 1px solid #feb2b2;
        }

        .status.pending {
            background: #fef5e7;
            color: #d69e2e;
            border: 1px solid #fbd38d;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Email Draft Styling */
        .email-draft {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .email-draft h4 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .email-content {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            line-height: 1.6;
            color: #4a5568;
        }

        /* AI Automation Specific Styling */
        .ai-automation-results {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .ai-automation-results h3 {
            color: #0c4a6e;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-project-diagram"></i> Flow System</h1>
            <p>AI-Powered Workflow Automation Platform</p>
            <div class="header-badges">
                <span class="badge"><i class="fas fa-robot"></i> AI Automation</span>
                <span class="badge"><i class="fas fa-search"></i> Enhanced Search</span>
                <span class="badge"><i class="fas fa-cogs"></i> Workflow Engine</span>
                <span class="badge"><i class="fas fa-chart-line"></i> Smart Analytics</span>
            </div>
        </div>

        <!-- Features Overview -->
        <div class="features-grid">
            <div class="feature-card">
                <i class="fas fa-brain"></i>
                <h3>AI-Powered Intelligence</h3>
                <p>Advanced natural language processing with intent detection and smart query routing</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-search-plus"></i>
                <h3>Enhanced Search</h3>
                <p>Multi-source search with relevance filtering, deduplication, and quality scoring</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-route"></i>
                <h3>Workflow Automation</h3>
                <p>Intelligent plan compilation and step-by-step execution with real-time monitoring</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-chart-bar"></i>
                <h3>Analytics & Insights</h3>
                <p>Comprehensive metrics, quality analysis, and performance optimization</p>
            </div>
        </div>

        <!-- Examples Section -->
        <div class="card examples-section">
            <h2><i class="fas fa-lightbulb"></i> Example Prompts</h2>
            <p style="color: #718096; margin-bottom: 20px;">Try these pre-built examples to see the system in action:</p>
            <div class="examples-grid">
                <div class="example-card" onclick="loadExample('ai_automation')">
                    <h4><i class="fas fa-robot"></i> AI Automation Digest</h4>
                    <p>Compile top 5 AI automation items, summarize each, and create email draft</p>
                </div>
                <div class="example-card" onclick="loadExample('market_research')">
                    <h4><i class="fas fa-chart-line"></i> Market Research</h4>
                    <p>Research latest trends in AI marketing tools and summarize findings</p>
                </div>
                <div class="example-card" onclick="loadExample('competitor_analysis')">
                    <h4><i class="fas fa-users"></i> Competitor Analysis</h4>
                    <p>Analyze the top 5 competitors in the workflow automation space, compare their features, and identify market gaps</p>
                </div>
                <div class="example-card" onclick="loadExample('technical_research')">
                    <h4><i class="fas fa-code"></i> Technical Research</h4>
                    <p>Find latest developments in machine learning automation</p>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="main-grid">
            <!-- Input Section -->
            <div class="card input-section">
                <h2><i class="fas fa-keyboard"></i> Natural Language Input</h2>
                <div class="input-group">
                    <label for="prompt">Describe what you want to accomplish:</label>
                    <textarea id="prompt" rows="4" placeholder="Example: Compile the top 5 items about 'AI automation', summarize each in ~1 sentence, and prepare an email draft to founders@company.com"></textarea>
                </div>
                <div class="input-group">
                    <label for="context">Context (Optional):</label>
                    <select id="context">
                        <option value="">Select context...</option>
                        <option value="ai_automation">AI Automation</option>
                        <option value="business">Business Research</option>
                        <option value="technical">Technical Analysis</option>
                        <option value="market_research">Market Research</option>
                    </select>
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="parsePrompt()">
                        <i class="fas fa-magic"></i> Parse & Plan
                    </button>
                    <button class="btn btn-secondary" onclick="clearInput()">
                        <i class="fas fa-eraser"></i> Clear
                    </button>
                </div>
            </div>
        </div>

        <!-- Plan Display Section -->
        <div class="card" id="planSection" style="display: none;">
            <h2><i class="fas fa-list-check"></i> Execution Plan</h2>
            <div id="planContent"></div>
            <div class="button-group" style="margin-top: 20px;">
                <button class="btn btn-success" onclick="executePlan()">
                    <i class="fas fa-play"></i> Execute Plan
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div class="card results-section" id="resultsSection" style="display: none;">
            <h2><i class="fas fa-chart-bar"></i> Execution Results</h2>
            <div id="resultsContent"></div>
        </div>

        <!-- System Status -->
        <div class="card">
            <h2><i class="fas fa-server"></i> System Status</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div class="status success">
                    <i class="fas fa-check-circle"></i>
                    <span>Flow System: Active</span>
                </div>
                <div class="status success">
                    <i class="fas fa-check-circle"></i>
                    <span>Search Engine: Ready</span>
                </div>
                <div class="status success">
                    <i class="fas fa-check-circle"></i>
                    <span>AI Models: Loaded</span>
                </div>
                <div class="status success">
                    <i class="fas fa-check-circle"></i>
                    <span>APIs: Connected</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPlan = null;
        let currentResults = null;

        // Load example prompts
        function loadExample(type) {
            const examples = {
                ai_automation: "Compile the top 5 items about 'AI automation', summarize each in ~1 sentence, and prepare an email draft to founders@company.com",
                market_research: "Research the latest trends in AI marketing tools for 2025, find top 10 tools, and create a market analysis summary",
                competitor_analysis: "Analyze the top 5 competitors in the workflow automation space, compare their features, and identify market gaps",
                technical_research: "Find the latest developments in machine learning automation, research top 5 papers, and summarize key innovations"
            };
            
            document.getElementById('prompt').value = examples[type];
            document.getElementById('context').value = type;
        }

        // Clear input
        function clearInput() {
            document.getElementById('prompt').value = '';
            document.getElementById('context').value = '';
            hideSections();
        }

        // Hide sections
        function hideSections() {
            document.getElementById('planSection').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'none';
        }

        // Parse prompt and create plan
        async function parsePrompt() {
            const prompt = document.getElementById('prompt').value.trim();
            const context = document.getElementById('context').value;
            
            if (!prompt) {
                alert('Please enter a prompt first!');
                return;
            }

            // Show loading state
            const parseBtn = document.querySelector('.btn-primary');
            const originalText = parseBtn.innerHTML;
            parseBtn.innerHTML = '<div class="loading"></div> Parsing...';
            parseBtn.disabled = true;

            try {
                const response = await fetch('/api/parse', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt, context })
                });

                const data = await response.json();
                
                if (data.plan) {
                    currentPlan = data.plan;
                    displayPlan(data.plan);
                    document.getElementById('planSection').style.display = 'block';
                } else {
                    alert('Failed to parse prompt: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error parsing prompt. Please try again.');
            } finally {
                // Restore button state
                parseBtn.innerHTML = originalText;
                parseBtn.disabled = false;
            }
        }

        // Display plan
        function displayPlan(plan) {
            const planContent = document.getElementById('planContent');
            
            let html = `
                <div style="background: #f7fafc; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: #4a5568; margin-bottom: 15px;">🎯 Goal: ${plan.goal}</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div><strong>Estimated Time:</strong> ${plan.estimated_time}</div>
                        <div><strong>Steps:</strong> ${plan.steps.length}</div>
                        <div><strong>Created:</strong> ${new Date(plan.created_at).toLocaleString()}</div>
                    </div>
                </div>
                <h3 style="color: #4a5568; margin-bottom: 15px;">📋 Execution Steps:</h3>
            `;

            plan.steps.forEach((step, index) => {
                html += `
                    <div style="background: white; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="color: #4a5568; margin: 0;">Step ${index + 1}: ${step.action}</h4>
                            <span class="status ${step.status === 'completed' ? 'success' : step.status === 'failed' ? 'error' : 'pending'}">
                                ${step.status === 'completed' ? '<i class="fas fa-check-circle"></i> Completed' : 
                                  step.status === 'failed' ? '<i class="fas fa-times-circle"></i> Failed' : 
                                  '<i class="fas fa-clock"></i> Pending'}
                            </span>
                        </div>
                        <p style="color: #718096; margin-bottom: 10px;"><strong>Description:</strong> ${step.description}</p>
                        <p style="color: #718096; margin-bottom: 10px;"><strong>Expected Output:</strong> ${step.expected_output}</p>
                        ${step.parameters ? `<p style="color: #718096;"><strong>Parameters:</strong> ${JSON.stringify(step.parameters)}</p>` : ''}
                    </div>
                `;
            });

            planContent.innerHTML = html;
        }

        // Execute plan
        async function executePlan() {
            if (!currentPlan) {
                alert('No plan to execute!');
                return;
            }

            // Show loading state
            const executeBtn = document.querySelector('.btn-success');
            const originalText = executeBtn.innerHTML;
            executeBtn.innerHTML = '<div class="loading"></div> Executing...';
            executeBtn.disabled = true;

            try {
                const response = await fetch('/api/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ plan: currentPlan })
                });

                const data = await response.json();
                
                if (data.success) {
                    currentResults = data;
                    displayResults(data);
                    document.getElementById('resultsSection').style.display = 'block';
                } else {
                    alert('Plan execution failed: ' + data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error executing plan. Please try again.');
            } finally {
                // Restore button state
                executeBtn.innerHTML = originalText;
                executeBtn.disabled = false;
            }
        }

        // Display results
        function displayResults(data) {
            const resultsContent = document.getElementById('resultsContent');
            
            let html = `
                <div style="background: #f0f9ff; border: 2px solid #0ea5e9; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: #0c4a6e; margin-bottom: 15px;">✅ Plan Execution Complete</h3>
                    <p style="color: #0c4a6e;"><strong>Status:</strong> ${data.message}</p>
                </div>
            `;

            // Show execution steps with results
            if (data.result && data.result.steps) {
                html += '<h3 style="color: #4a5568; margin-bottom: 15px;">📊 Execution Results:</h3>';
                
                data.result.steps.forEach((step, index) => {
                    html += `
                        <div style="background: white; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h4 style="color: #4a5568; margin: 0;">Step ${index + 1}: ${step.action}</h4>
                                <span class="status ${step.status === 'completed' ? 'success' : step.status === 'failed' ? 'error' : 'pending'}">
                                    ${step.status === 'completed' ? '<i class="fas fa-check-circle"></i> Completed' : 
                                      step.status === 'failed' ? '<i class="fas fa-times-circle"></i> Failed' : 
                                      '<i class="fas fa-clock"></i> Pending'}
                                </span>
                            </div>
                            <p style="color: #718096; margin-bottom: 10px;"><strong>Description:</strong> ${step.description}</p>
                            ${step.output ? `<div style="background: #f7fafc; border-radius: 8px; padding: 15px; margin-top: 10px;"><strong>Output:</strong> ${step.output}</div>` : ''}
                        </div>
                    `;
                });
            }

            // Show stored results if available
            if (data.stored_results) {
                html += '<div class="ai-automation-results">';
                html += '<h3><i class="fas fa-robot"></i> AI Automation Results</h3>';
                
                if (data.stored_results.results && data.stored_results.results.length > 0) {
                    html += '<h4>🔍 Search Results:</h4>';
                    data.stored_results.results.forEach((result, index) => {
                        html += `
                            <div class="result-card" style="margin-bottom: 15px;">
                                <h4>${index + 1}. ${result.title || 'Untitled'}</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Score:</span>
                                    <span class="metric-value">${result.score || 'N/A'}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Summary:</span>
                                    <span class="metric-value">${result.snippet || result.content || 'No summary available'}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Source:</span>
                                    <span class="metric-value"><a href="${result.url || '#'}" target="_blank">${result.url || 'N/A'}</a></span>
                                </div>
                            </div>
                        `;
                    });
                }

                if (data.stored_results.email_draft) {
                    html += '<div class="email-draft">';
                    html += '<h4><i class="fas fa-envelope"></i> Email Draft:</h4>';
                    html += '<div class="email-content">' + data.stored_results.email_draft + '</div>';
                    html += '</div>';
                }

                html += '</div>';
            }

            resultsContent.innerHTML = html;
        }



        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Flow System Frontend Loaded');
            
            // Simple cache-busting: add timestamp to all image and CSS requests
            const timestamp = Date.now();
            const links = document.querySelectorAll('link[rel="stylesheet"]');
            links.forEach(link => {
                if (link.href && !link.href.includes('?')) {
                    link.href = link.href + '?v=' + timestamp;
                }
            });
        });
    </script>
</body>
</html>
